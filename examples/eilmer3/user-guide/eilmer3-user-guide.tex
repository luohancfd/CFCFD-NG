% eilmer3-user-guide.tex
% PJ, March 2007 -- elmer2 version
%     September 2008 -- eilmer3 version
%
\documentclass[12pt,a4paper,twoside]{article}
\usepackage[body={16cm,24.5cm}]{geometry}
\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor=blue}
\usepackage{graphicx}
\usepackage{makeidx}
% \usepackage{showidx}
\usepackage{listings}
\usepackage{lscape}
\usepackage{longtable}
\usepackage{amsmath}
\usepackage{subfig}
\lstset{basicstyle=\ttfamily\scriptsize,identifierstyle=,keywordstyle=}
\usepackage{booktabs}

%------------------------------------------------------------------
% a couple horizontal bars to delimit embedded code
% the width suits the page size set above and
% the mathmode eliminates spaces between the three elements
\newcommand{\topbar}{\ensuremath{
    \rule{0.1mm}{2.0mm} \rule[2.0mm]{159.5mm}{0.1mm} \rule{0.1mm}{2.0mm}
}}
\newcommand{\bottombar}{\ensuremath{
    \rule{0.1mm}{2.0mm} \rule{159.5mm}{0.1mm} \rule{0.1mm}{2.0mm}
}}
\newcommand{\topbarshort}{\ensuremath{
    \rule{0.1mm}{2.0mm} \rule[2.0mm]{149.5mm}{0.1mm} \rule{0.1mm}{2.0mm}
}}
\newcommand{\bottombarshort}{\ensuremath{
    \rule{0.1mm}{2.0mm} \rule{149.5mm}{0.1mm} \rule{0.1mm}{2.0mm}
}}
%------------------------------------------------------------------

\title{
    The Eilmer3 Code: User Guide and Example Book.
}
\author{
    Mechanical Engineering Report 2008/07\\
    P. A. Jacobs\thanks{Queensland Geothermal Energy Centre of Excellence, The University of Queensland, Brisbane, Australia.} 
    and 
    R. J. Gollan\thanks{Centre for Hypersonics, The University of Queensland, Brisbane, Australia.}\\
    {\normalsize with contributions\thanks{These contributions have come in the form of examples, debugging, 
    proof-reading and constructive comments on the codes and this document, and code for special cases.}
    from a cast of many, including:}\\
    {\normalsize Peter Blyton,}
    {\normalsize Arianna Bosco,}
    {\normalsize Djamel Boutamine,}
    {\normalsize Laurie Brown,} \\
    {\normalsize David Buttsworth,}
    {\normalsize Wilson Chan,} 
    {\normalsize Sam Chiu,}
    {\normalsize Chris Craddock,} 
    {\normalsize Brian Cook,} \\ 
    {\normalsize Jason Czapla,} 
    {\normalsize Carlos de Miranda-Ventura,} 
    {\normalsize Andrew Denman,}
    {\normalsize Elise Fahy,}
    {\normalsize David Gildfind,} \\
    {\normalsize Richard Gooze\'{e},}
    {\normalsize Stefan Hess,} 
    {\normalsize Carolyn Jacobs,} 
    {\normalsize Ingo Jahn,} 
    {\normalsize Ian Johnston,}
    {\normalsize Ojas Joshi,} \\
    {\normalsize Rainer Kirchhartz,} 
    {\normalsize Matt McGilvray,} 
    {\normalsize David Mee,} 
    {\normalsize Luke Montgomery,} 
    {\normalsize Jan-Pieter Nap,} \\
    {\normalsize Brendan O'Flaherty,} 
    {\normalsize Andrew Pastrello,} 
    {\normalsize Paul Petrie-Repar,} 
    {\normalsize Dan Potter,} \\
    {\normalsize Deepak Ramanath,} 
    {\normalsize Michael Scott,}
    {\normalsize Umar Sheikh,} 
    {\normalsize Ben Stewart,} 
    {\normalsize Joseph Tang,} \\
    {\normalsize Katsu Tanimizu,} 
    {\normalsize Paul van der Laan,} 
    {\normalsize Jaidev Vesudevan,} 
    {\normalsize Mike Wendt,} \\
    {\normalsize Vince Wheatley,} 
    {\normalsize Adrian Window,} 
    {\normalsize Hannes Wojciak,}
    {\normalsize Fabian Zander}
}
% \date{September 2008}
\makeindex

\begin{document}
\maketitle

% For some reason, the abstract environment causes the labelling in
% the metapost figures to disappear; strange!
% \begin{abstract}
% \end{abstract}
\centerline{\textbf{Preface}}
Eilmer3 is an integrated collection of programs for the simulation of transient,
compressible flow in two and three spatial dimensions.
It provides a preparation program that can be used to set up a database of
simulation parameters, a block-structured grid defining the flow domain and an
initial flow field.
These items are then used as a starting point for the main simulation program
which computes a series of snapshots of the evolving flow.
Eilmer3 is part of the larger collection of compressible flow simulation codes
found at \url{http://www.mech.uq.edu.au/cfcfd/}.

\medskip
This user guide contains a collection of example simulations: scripts, results
and commentary.
It may be convenient for new users of the code to identify an example
close to the situation that they wish to model and then adapt the 
scripts for that example.

\cleardoublepage
\tableofcontents

%------------------------------------------------------------------
\cleardoublepage
\baselineskip = 1.5pc

\part{User guide}

\section{Introduction}
%
Eilmer3 is an integrated collection of programs for the simulation of transient,
compressible flow in two and three dimensions.
It provides a preparation program (\texttt{e3prep.py}) that can be used to set up a database of
simulation parameters, a block-structured, body-fitted grid defining the flow domain and an
initial flow field.
These items are then used as a starting point for the main simulation program (\texttt{e3shared.exe})
which computes a series of snapshots of the evolving flow.
Finally, a rudimentary but versatile postprocessing program (\texttt{e3post.py}) makes the flow data
available for further analysis.

\medskip
Eilmer3 is a derivative of the code mbcns2 which, in turn was an experiment in writing
the mb\_cns code in C++.
Once it was determined that there were clear benefits in using C++,
our three-dimensional flow code Elmer was then reworked in C++ as Elmer2.
At the same time, we experimented with using the Python language for the user's input script and 
embedding the Lua language in order to make some of the boundary conditions programmable.
Of course, these codes being experiments in C++, we soon decided that it could all be done
much more cleanly and be made much more versatile if we just reworked some of the basic modules.
Thus, the thermochemistry was reworked and the separate two and three dimensional codes merged
into Eilmer3.
The name change is to avoid a naming clash with the Elmer finite-element code 
from Finland.\footnote{\url{http://www.csc.fi/elmer}}

\medskip 
The following sections provide example input scripts and shell scripts for a number of simulations.
These are intended to be starting points for your own simulations and should be studied together with 
the other manuals that can be found in the documentation section of the 
Compressible Flow CFD Group web site:  
\url{http://www.mech.uq.edu.au/cfcfd/}.\index{Internet address}
Study these scripts carefully; some of the interesting bits of the documentation are
embedded within them.

\medskip
For a description of the methods coded into \texttt{Eilmer3}, see the companion report \cite{jacobs_etal_2010b}
which covers the gas-dynamic formulation and the basic thermochemistry components.

\clearpage
%------------------------------------------------------------------
\section{Building and installing the programs}
%
The core solver and its modules are mainly written in C/C++ for speed and the benefits of compile time checking. 
The pre- and post-processing programs are mainly Python so that we get flexibility and convenient customization.
There is also a little Tcl/Tk and Lua.

\medskip
Our main development environment is Linux but the programs can be deployed on
Linux, flavours of Unix such as MacOS-X and MS-Windows (using Cygwin).
The main requirement is that the C/C++ compilers, the Tcl and Python
interpreters be available, along with their supporting libraries and 
various extensions. 
The source code of the Lua interpreter is included in with Eilmer3.
The reStructuredText file \texttt{eilmer3.rst} (Appendix\,\ref{getting-started-file}) 
or the corresponding HTML file from the web site\footnote{The web site 
\url{http://www.mech.uq.edu.au/cfcfd/} has a nicely formatted set of instructions,
detailed API documents that have been extracted from the source code and 
a number of examples.  It is regularly expanded and updated.}
provides more detail including 
the actual commands needed to build and install the programs.

\medskip
If you are not accustomed to working with Unix/Linux, 
have a look at Appendix\,\ref{linux-command-notes-sec}
for a brief introduction to working on the command line.


%------------------------------------------------------------------
\input{running-simulations}
\input{user-input-script}
 
%-------------------------------------------------------------------
% The examples...
\cleardoublepage

\part{Examples for 2D flow}
%
These examples are graded from simple geometry specification and gas model specification
to more complex.
Initially, simple box regions and single-species ideal gas models are used, followed by
examples with curved boundaries, equilibrium gas models and, also, 
multi-species thermally-perfect gases with finite-rate chemical kinetics.
Later examples also use more of Python's capabilities with the input script for the 
heat-transfer to a sphere, for example, being written as a template script and a top-level 
coordinating script that runs the simulation a number of times with better grid resolution.

% 2D examples
\include{cone20-simple}
\cleardoublepage
\include{hakkinen-SWLBLI}
\cleardoublepage
\include{axi-cylinder}
\cleardoublepage
\include{cylinder-flare}
\cleardoublepage
\include{double-cone-sharp-nose}
\cleardoublepage
\include{sharp}
\cleardoublepage
\include{sharp-pyfun}
\cleardoublepage
\include{blunt-wedge}
\cleardoublepage
\include{bar-476}
\cleardoublepage
\include{back-nozzle}
\cleardoublepage
\include{sawada-sphere}
\cleardoublepage
\include{classic-shock-tube}
\cleardoublepage
\include{sphere-heat-transfer}
\cleardoublepage
\include{n90}
\cleardoublepage
\include{lehr-sphere}
\cleardoublepage
\include{mnm-implosion-problem}
\cleardoublepage
\include{periodic-shear-layer}
\cleardoublepage
\include{cone20-udf}
\cleardoublepage
\include{vortex}
\cleardoublepage
\include{mms-euler}
\cleardoublepage
\include{mms-viscous}
\cleardoublepage
\include{odw}
\cleardoublepage
\include{turbo-sc10}
\cleardoublepage
\include{turbo-sc10-parametric}
\cleardoublepage
\include{hayabusa}
\cleardoublepage

\part{Examples for 3D flow}
%
Now, let's do it all again in three dimensions.

% 3D examples
\include{simple-ramp}
\cleardoublepage
\include{sod-3d}
\cleardoublepage
\include{inject}
\cleardoublepage
\include{finite-cylinder}
\cleardoublepage
\include{sphere-cone}
\cleardoublepage
\include{scram1}
\cleardoublepage
\include{bianca-epfl}
\cleardoublepage

%--------------------------------------------------------------------
\part{References and Appendices}

\bibliographystyle{unsrt}
\bibliography{bibtex/pj,bibtex/computing,bibtex/gas_dynamic,bibtex/adm,bibtex/gas,bibtex/dan,bibtex/upwind}

\cleardoublepage
\appendix

\section{Instructions for installation and getting started}
\label{getting-started-file}\index{Getting started}\index{Installation}
%
The latest version of this files should be in the \texttt{doc/sphinx/} directory 
of the package of source files.\\
\topbar
\lstinputlisting[language={}]{../../../doc/sphinx/getting-started.rst}
\bottombar

\noindent
\topbar
\lstinputlisting[language={}]{../../../doc/sphinx/eilmer3.rst}
\bottombar

\cleardoublepage
\input{linux-command-line}

\cleardoublepage
\input{just-enough-python}

\cleardoublepage
\section{Make your own debugging cube}
\label{cube-development}
%
\centerline{\includegraphics[viewport=69 220 490 778,clip=true,angle=180]{figs/paper-cube-development.pdf}}

%\newpage 
%\input{../../../lib/gas_models2/tex/scriptnoneq}

\cleardoublepage
\section{cfpylib modules}\index{module!cfpylib}
There are a number of modules that are useful for the definition of flow
simulations but are not part of the Eilmer code.
These are available in a separate Python library that may be imported into the
user's job definition script.
 
\subsection{Billig shock shape correlation}\index{Billig}
\label{billig-correlation}
\topbar
\lstinputlisting[language={}]{../../../lib/cfpylib/gasdyn/billig.py}
\bottombar

\cleardoublepage
\input{gas_models}

\cleardoublepage
\input{chem}

\cleardoublepage
\input{therm-exchange}

\cleardoublepage
\input{udf}

\cleardoublepage
\input{paraview}

\cleardoublepage
\input{loadbalance}

\cleardoublepage
\input{radiation}

\cleardoublepage
\phantomsection % re-set the hyperref anchor so that TOC page number link is correct.
\addcontentsline{toc}{part}{\indexname}
\printindex
\end{document}
