% cylinder-flare.tex

\section{Hypersonic flow over a hollow cylinder with flare.}
\label{sec:cylinder-flare}
%
This is one of the hypersonic test flows provided by the Calspan-University of Buffalo Research Center (CUBRC).
As for the previous flows, it is an example that retains a very simple
geometric arrangement for the flow boundaries but inclusion of the viscous effects 
leads to a very challenging flow.
The experimental facility provides a Mach 10.3 flow of nitrogen along the cylinder with flare shown below 
in Figure\,\ref{fig:cylinder-flare-model}.
This model was used as part of an experimental campaign\,\cite{holden_etal_2002a,holden_wadhams_2003a} 
in the LENS shock tunnel at CUBRC.
The very high Mach number free stream produces a fairly strong leading-edge interaction region
at the sharp leading edge of the cylinder and a boundary layer develops along the cylinder surface.
The flare deflects the flow, inducing a strong shock, but the viscous effects lead to a separation 
bubble forming in the boundary layer on the cylinder surface.
The leading edge of the separation bubble also deflects the flow and forms another shock that
merges with the leading-edge interaction shock.
This combined shock happens to impinge on the flare surface and interact strongly with the boundary layer 
on the flare and the downstream end of the separation bubble.
These features interact strongly but the overall flow eventually settles to a steady state and the boundary
layer remains laminar.

\begin{figure}[htbp]
 \centering
 \subfloat[Physical model.]{\includegraphics[width=0.45\textwidth]
  {../2D/cylinder-flare/notes/cubrc-cylinder-with-flare.jpeg}}
 \subfloat[Geometric definition from \cite{maclean_holden_2004a}.  Dimensions in inches and mm.]
  {\includegraphics[width=0.55\textwidth]
   {../2D/cylinder-flare/notes/maclean-2004-0529-figure-1.png}}
 \caption{Hollow cylinder with extended flare used in the CUBRC experiments.}
 \label{fig:cylinder-flare-model}
\end{figure}

\bigskip
\subsection{Input script (.py)}
%
In setting up this exercise, we follow the details provided by MacLean\,\cite{maclean_holden_2004a}
and concentrate on the CUBRC Run 14 experiment.
We assume an ideal nitrogen free stream, with conditions 
$p$ = 31.88\,Pa, $\rho$=0.881\,g/m$^3$, $u$ = 2.304\,km/s and a static temperature $T$=120.4\,K.
The actual nitrogen flow in the shock tunnel nozzle was far from ideal and had an estimated
vibrational temperature of 2467\,K.
However, for the simulation reported here, this vibrational energy is assumed frozen and thus ignored.
The model surface temperature was a constant 295.2\,K.

\noindent
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/cyl-flare.py}
\bottombar


\bigskip
\subsection{Running the simulation}
%
Figure\,\ref{fig:cylinder-flare-geometry} shows the flow region, as modelled for simulation.
The region is very simple but we have divided it into 24 blocks so that the computational load 
can be shared across a number of CPU cores.

\begin{figure}[htbp]
 \centering
 \includegraphics[width=\textwidth,viewport=0 0 517 321,clip=true]{../2D/cylinder-flare/cyl-flare-edited.pdf}
 \caption{Schematic view of the simulated flow region for the hypersonic flow
          over a cylinder with flare.}
 \label{fig:cylinder-flare-geometry}
\end{figure}

\medskip
In terms of required computer time, this simulation is a demanding.
Unless you are extremely patient, you are advised to run it on a cluster computer,
as was done for the results shown here.
The job scipts submitted to the batch system are shown below.
The preparation of the grids and initial flow-state files was done on a local workstation, 
these files transferred to the cluster computer file system and 
then the simulation was done in two stages, 
0--2.5\,ms and 2.5\,ms--5\,ms.
In between the simulation stages, the \texttt{cyl-flare.control} file was edited by hand
to extend the maximum time from 2.5\,ms to 5.0\,ms.
Note that the 24 blocks have been grouped, via the mpimap file 
(that was generated by the e3loadbalance program), to 12 MPI tasks.
Each of the simulation stages required a little less than a day on 12 cores of a Dell cluster 
with 2.2\,GHz Xeon processors.
The particular cluster was called ``arcus'' and was located at the Oxford e-Research Centre.

\noindent
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/prep.sh}\index{mpimap!example of use}
\bottombar\\
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/run-arcus.sh}\index{PBS batch system!example of use}
\bottombar\\
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/run-arcus-2.sh}
\bottombar\\

\subsection{Results}
%
Figure\,\ref{fig:cylinder-flare-field-data} shows some of the flow field data at $t$=5\,ms after flow start.
The leading-edge interaction shock and the shock caused by the boundary-layer separation
are both clearly defined.
The leading-edge interaction shock starts strong but weakens with the immediately following expansion fan.
The shock from the start of the separation region only becomes clear a small distance above the surface,
near the outer edge of the boundary layer.
The two shocks merge, shortly before impinging on the flare surface.
By the time shown, the flow has settled to a steady-state configuration,
as confirmed by the history of the separation point location on the cylinder surface,
plotted in Figure\,\ref{fig:cylinder-flare-separation-point}.

\begin{figure}[htbp]
 \centering
 \subfloat[Pressure field.]{\includegraphics[width=0.7\textwidth]
    {../2D/cylinder-flare/p-field-5p000ms.png}\label{fig:cylinder-flare-pressure}}\\
 \subfloat[Temperature field.]{\includegraphics[width=0.7\textwidth]
    {../2D/cylinder-flare/T-field-5p000ms.png}\label{fig:cylinder-flare-temperature}}\\
 \subfloat[Mach number.]{\includegraphics[width=0.7\textwidth]
    {../2D/cylinder-flare/mach-field-5p000ms.png}\label{fig:cylinder-flare-mach}}
 \caption{Computed flow field at $t$=5\,ms.}
 \label{fig:cylinder-flare-field-data}
\end{figure}

\begin{figure}[htb]
 \centering
 \includegraphics[width=0.7\textwidth]{../2D/cylinder-flare/separation-location.pdf}
 \caption{History of the separation location along the cylinder surface.}
 \label{fig:cylinder-flare-separation-point}
\end{figure}

\clearpage

\medskip
The real proof of success is in comparison with the experimental data.
Figure\,\ref{fig:cylinder-flare-plate-data-compare} shows the pressure and heat-transfer
along the surface of the cylinder and the flare.
The simulation has done a good job of estimating the pressure distribution right 
through the separation zone and the shock-interaction zone on the flare.
There is a sudden drop in pressure (and a corresponding rise in heat transfer)
at the right end of the simulation domain where the boundary layer thins.
This is expected because the expansion off the trailing edge of the flare
would propagate upstream a little, through the subsonic part of the boundary layer.

\medskip
The simulation has also done a good job on the heat transfer estimate,
which has been computed from the field data using the script in Section\,\ref{cylinder-flare-post-processing}.
This quantity required lots of resolution to compute accurately and 
difficult to measure so it is reassuring that both
sets of data line up nicely in the boundary layer leading into the sepration region,
through the separation, and also after the interaction region on the flare surface.
The separation bubble appears to be well captured in position and extent.

\begin{figure}[htbp]
 \centering
 \subfloat[Pressure.]{\includegraphics[width=0.5\textwidth]
    {../2D/cylinder-flare/surface-pressure.pdf}\label{fig:cylinder-flare-surface-pressure}}
 \subfloat[Heat transfer.]{\includegraphics[width=0.5\textwidth]
    {../2D/cylinder-flare/surface-heat-transfer.pdf}\label{fig:cylinder-flare-heat-transfer}}
 \caption{Distribution of pressure and heat transfer along the cylinder and flare.
   Simulation data is recorded at $t$=5\,ms into the simulation.
   Experimental data is for Run 14 of the CUBRC experiment\,\cite{holden_etal_2002a}.}
 \label{fig:cylinder-flare-plate-data-compare}
\end{figure}

\bigskip
\subsection{Postprocessing heat transfer and separation-point tracking}
\label{cylinder-flare-post-processing}
%
The scripts below use the functions imported from \texttt{e3\_flow.py}
at a slightly higher level than in the cone20 example.
The first extracts the data for the cell nearest to the cylinder and flare surface
and uses that data to compute the expected shear stress and heat transfer at the surface.
The second looks at the x-component of the velocity of the first cell above the 
cylinder surface to identify the location of the start of the separation region
for all frames of the solution.
After writing the location data to a file, it uses the SciPy optimization module 
to fit a simple function to that data, 
in order to estimate the asymptotic position of the separation point for large times.

\noindent
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/surface_properties.py}
\bottombar

\noindent
\topbar
\lstinputlisting[language={}]{../2D/cylinder-flare/separation_point.py}
\bottombar

\subsection{Notes}
\begin{itemize}
 \item The experimental data has come from a spreadsheet, 
 kindly provided by Dr Matthew MacLean of CUBRC.
 Plotting was done with the following GNUPlot scripts.
 \lstinputlisting[language={}]{../2D/cylinder-flare/surface-pressure.gnuplot}
 \lstinputlisting[language={}]{../2D/cylinder-flare/surface-heat-transfer.gnuplot}
\end{itemize}
